<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>jumpstart-builtin-xgboost-nyc-taxi</title>
    <meta name="description" content="Data Science on AWS - O'Reilly Book - Early 2021">
    <meta name="title" content="Data Science on AWS">
    <meta name="keywords" content="Data Science, AWS, Amazon Web Services, SageMaker, TensorFlow, PyTorch, Kubeflow, Athena, Step Functions, Redshift, DynamoDB, QuickSight, Glue, EMR">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/img/sagemaker-logo-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/img/sagemaker-logo-32x32.png">
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="../assets/css/Features-Minimal-icons.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ECMNXM9Q6Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ECMNXM9Q6Y');
</script>

<!-- Github Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- Full Story -->
<script>
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
window['_fs_org'] = 'NWGC4';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
    o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
    g.anonymize=function(){g.identify(!!0)};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.log = function(a,b){g("log",[a,b])};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
    g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
    if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
    g._v="1.2.0";
})(window,document,window['_fs_namespace'],'script','user');
</script>
</head>

<body><div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Regression-with-Amazon-SageMaker-XGBoost-algorithm">Regression with Amazon SageMaker XGBoost algorithm<a class="anchor-link" href="#Regression-with-Amazon-SageMaker-XGBoost-algorithm">¶</a></h1><p><em><strong>Single machine training for regression with Amazon SageMaker XGBoost algorithm</strong></em></p>
<hr>
<hr>
<h2 id="Contents">Contents<a class="anchor-link" href="#Contents">¶</a></h2><ol>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Setup">Setup</a></li>
<li><a href="#Fetching-the-dataset">Fetching the dataset</a></li>
<li><a href="#Data-ingestion">Data Ingestion</a></li>
<li><a href="#Training-the-XGBoost-model">Training the XGBoost model</a></li>
<li><a href="#Plotting-evaluation-metrics">Plotting evaluation metrics</a></li>
<li><a href="#Set-up-hosting-for-the-model">Set up hosting for the model</a></li>
<li><a href="#Import-model-into-hosting">Import model into hosting</a></li>
<li><a href="#Create-endpoint-configuration">Create endpoint configuration</a></li>
<li><a href="#Create-endpoint">Create endpoint</a></li>
<li><a href="#Validate-the-model-for-use">Validate the model for use</a></li>
</ol>
<hr>
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction">¶</a></h2><p>This notebook demonstrates the use of Amazon SageMaker’s implementation of the XGBoost algorithm to train and host a regression model. We use the <a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/regression.html">Abalone data</a> originally from the UCI data repository [1]. More details about the original dataset can be found <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/abalone/abalone.names">here</a>.  In the libsvm converted <a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/regression.html">version</a>, the nominal feature (Male/Female/Infant) has been converted into a real valued feature. Age of abalone is to be predicted from eight physical measurements. Dataset is already processed and stored on S3. Scripts used for processing the data can be found in the <a href="#Appendix">Appendix</a>. These include downloading the data, splitting into train, validation and test, and uploading to S3 bucket.</p>
<blockquote>
<p>[1] Dua, D. and Graff, C. (2019). UCI Machine Learning Repository [http://archive.ics.uci.edu/ml]. Irvine, CA: University of California, School of Information and Computer Science.</p>
</blockquote>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup">¶</a></h2><p>This notebook was tested in Amazon SageMaker Studio on a ml.t3.medium instance with Python 3 (Data Science) kernel.</p>
<p>Let's start by specifying:</p>
<ol>
<li>The S3 buckets and prefixes that you want to use for saving the model and where training data is located. This should be within the same region as the Notebook Instance, training, and hosting.</li>
<li>The IAM role arn used to give training and hosting access to your data. See the documentation for how to create these. Note, if more than one role is required for notebook instances, training, and/or hosting, please replace the boto regexp with a the appropriate full IAM role arn string(s).</li>
</ol>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs   celltag_parameters">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sagemaker</span>

<span class="n">role</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">region_name</span>

<span class="c1"># S3 bucket where the training data is located.</span>
<span class="c1"># Feel free to specify a different bucket and prefix</span>
<span class="c1">#data_bucket = f"jumpstart-cache-prod-{region}"</span>
<span class="n">data_bucket</span> <span class="o">=</span> <span class="s2">"dsoaws"</span>
<span class="c1">#data_prefix = "1p-notebooks-datasets/abalone/libsvm"</span>

<span class="c1"># 7.8 hours for all years with ml.m5.24xlarge</span>
<span class="c1"># TODO:  Use csv or parquet?</span>
<span class="c1">#data_prefix = "nyc-taxi-orig-cleaned-csv-without-header-all-years/all-years.csv" # SUCCESS</span>
<span class="c1">#data_prefix = "nyc-taxi-orig-cleaned-parquet-all-years-multiple-files/"          # FAILURE</span>
<span class="n">data_prefix</span> <span class="o">=</span> <span class="s2">"nyc-taxi-orig-cleaned-parquet-all-years/"</span>                          <span class="c1"># FAILURE?</span>
<span class="n">data_bucket_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"s3://</span><span class="si">{</span><span class="n">data_bucket</span><span class="si">}</span><span class="s2">"</span>

<span class="c1">##########################################################</span>
<span class="c1"># TODO:  Create /train (80%) and /validation (20%) splits</span>
<span class="c1">##########################################################</span>

<span class="c1">##########################################################</span>
<span class="c1"># TODO:  Add experiment_config to script mode</span>
<span class="c1">##########################################################</span>

<span class="c1"># S3 bucket for saving code and model artifacts.</span>
<span class="c1"># Feel free to specify a different bucket and prefix</span>
<span class="n">output_bucket</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">output_prefix</span> <span class="o">=</span> <span class="s2">"sagemaker/DEMO-xgboost-nyc-taxi"</span>
<span class="n">output_bucket_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"s3://</span><span class="si">{</span><span class="n">output_bucket</span><span class="si">}</span><span class="s2">"</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws s3 ls <span class="nv">$data_bucket_path</span>/<span class="nv">$data_prefix</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Training-the-XGBoost-model">Training the XGBoost model<a class="anchor-link" href="#Training-the-XGBoost-model">¶</a></h2><p>After setting training parameters, we kick off training, and poll for status until training is completed, which in this example, takes between 5 and 6 minutes.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.amazon.amazon_estimator</span> <span class="kn">import</span> <span class="n">get_image_uri</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">get_image_uri</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s2">"xgboost"</span><span class="p">,</span> <span class="s2">"1.5-1"</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>

<span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"jumpstart-example-xgboost-nyc-taxi-</span><span class="si">{</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M-%S'</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Training job"</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="n">display</span><span class="p">(</span>
    <span class="n">HTML</span><span class="p">(</span>
        <span class="s1">'&lt;b&gt;Review &lt;a target="blank" href="https://console.aws.amazon.com/sagemaker/home?region=</span><span class="si">{}</span><span class="s1">#/jobs/</span><span class="si">{}</span><span class="s1">"&gt;Training Job&lt;/a&gt; After About 5 Minutes&lt;/b&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">region</span><span class="p">,</span> <span class="n">job_name</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Ensure that the training and validation data folders generated above are reflected in the "InputDataConfig" parameter below.</span>

<span class="c1"># sagemaker training time for all data:  7.78 hours * 6 ml.m5.24xlarge instances * $5.53 = $258.14 (ec2 + sagemaker surcharge)</span>
<span class="c1"># other training time for all data:  5.50 hours * 6 ml.i3.8xlarge instances * $7.20 = $237.60 (ec2 + other surcharge)</span>

<span class="n">create_training_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"AlgorithmSpecification"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"TrainingImage"</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span> <span class="s2">"TrainingInputMode"</span><span class="p">:</span> <span class="s2">"File"</span><span class="p">},</span>
    <span class="s2">"RoleArn"</span><span class="p">:</span> <span class="n">role</span><span class="p">,</span>
    <span class="s2">"OutputDataConfig"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"S3OutputPath"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">output_bucket_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">/jumpstart-example-xgboost-nyc-taxi"</span><span class="p">},</span>
    <span class="s2">"ResourceConfig"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"InstanceCount"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">"InstanceType"</span><span class="p">:</span> <span class="s2">"ml.m5.24xlarge"</span><span class="p">,</span> <span class="s2">"VolumeSizeInGB"</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
    <span class="s2">"TrainingJobName"</span><span class="p">:</span> <span class="n">job_name</span><span class="p">,</span>
    <span class="s2">"HyperParameters"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"max_depth"</span><span class="p">:</span> <span class="s2">"5"</span><span class="p">,</span>
        <span class="s2">"eta"</span><span class="p">:</span> <span class="s2">"0.2"</span><span class="p">,</span>
        <span class="s2">"gamma"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
        <span class="s2">"min_child_weight"</span><span class="p">:</span> <span class="s2">"6"</span><span class="p">,</span>
        <span class="s2">"subsample"</span><span class="p">:</span> <span class="s2">"0.7"</span><span class="p">,</span>
<span class="c1">#        "silent": "0",</span>
<span class="c1">#        "objective": "reg:linear",</span>
        <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"reg:squarederror"</span><span class="p">,</span>
        <span class="s2">"num_round"</span><span class="p">:</span> <span class="s2">"50"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="c1">#    "StoppingCondition": {"MaxRuntimeInSeconds": 3600},</span>
    <span class="s2">"StoppingCondition"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"MaxRuntimeInSeconds"</span><span class="p">:</span> <span class="mi">54000</span><span class="p">},</span>
    <span class="s2">"InputDataConfig"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"ChannelName"</span><span class="p">:</span> <span class="s2">"train"</span><span class="p">,</span>
            <span class="s2">"DataSource"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"S3DataSource"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"S3DataType"</span><span class="p">:</span> <span class="s2">"S3Prefix"</span><span class="p">,</span>
<span class="c1"># TODO:  Using the /train split</span>
<span class="c1">#                    "S3Uri": f"{data_bucket_path}/{data_prefix}/train",</span>
                    <span class="s2">"S3Uri"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">data_bucket_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">data_prefix</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                    <span class="s2">"S3DataDistributionType"</span><span class="p">:</span> <span class="s2">"FullyReplicated"</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
<span class="c1"># TODO:  Use csv or parquet?</span>
<span class="c1">#            "ContentType": "csv",</span>
            <span class="s2">"ContentType"</span><span class="p">:</span> <span class="s2">"application/x-parquet"</span><span class="p">,</span>
            <span class="s2">"CompressionType"</span><span class="p">:</span> <span class="s2">"None"</span><span class="p">,</span>
        <span class="p">},</span>
<span class="c1"># TODO:  Using the /validation split</span>
        <span class="c1"># {</span>
        <span class="c1">#     "ChannelName": "validation",</span>
        <span class="c1">#     "DataSource": {</span>
        <span class="c1">#         "S3DataSource": {</span>
        <span class="c1">#             "S3DataType": "S3Prefix",</span>
        <span class="c1">#             "S3Uri": f"{data_bucket_path}/{data_prefix}/validation",</span>
        <span class="c1">#             "S3DataDistributionType": "FullyReplicated",</span>
        <span class="c1">#         }</span>
        <span class="c1">#     },</span>
        <span class="c1">#     "ContentType": "csv",</span>
        <span class="c1">#     "CompressionType": "None",</span>
        <span class="c1"># },</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"sagemaker"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">create_training_job</span><span class="p">(</span><span class="o">**</span><span class="n">create_training_params</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">describe_training_job</span><span class="p">(</span><span class="n">TrainingJobName</span><span class="o">=</span><span class="n">job_name</span><span class="p">)[</span><span class="s2">"TrainingJobStatus"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">"Completed"</span> <span class="ow">and</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">"Failed"</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">describe_training_job</span><span class="p">(</span><span class="n">TrainingJobName</span><span class="o">=</span><span class="n">job_name</span><span class="p">)[</span><span class="s2">"TrainingJobStatus"</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="n">display</span><span class="p">(</span>
    <span class="n">HTML</span><span class="p">(</span>
        <span class="s1">'&lt;b&gt;Review &lt;a target="blank" href="https://console.aws.amazon.com/sagemaker/home?region=</span><span class="si">{}</span><span class="s1">#/jobs/</span><span class="si">{}</span><span class="s1">"&gt;Training Job&lt;/a&gt; After About 5 Minutes&lt;/b&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">region</span><span class="p">,</span> <span class="n">job_name</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Note that the "validation" channel has been initialized too. The SageMaker XGBoost algorithm actually calculates RMSE and writes it to the CloudWatch logs on the data passed to the "validation" channel.</p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Set-up-hosting-for-the-model">Set up hosting for the model<a class="anchor-link" href="#Set-up-hosting-for-the-model">¶</a></h2><p>In order to set up hosting, we have to import the model from training to hosting.</p>
<h3 id="Import-model-into-hosting">Import model into hosting<a class="anchor-link" href="#Import-model-into-hosting">¶</a></h3><p>Register the model with hosting. This allows the flexibility of importing models trained elsewhere.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>

<span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">-model"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">describe_training_job</span><span class="p">(</span><span class="n">TrainingJobName</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
<span class="n">model_data</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">"ModelArtifacts"</span><span class="p">][</span><span class="s2">"S3ModelArtifacts"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_data</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%time</span>
<span class="c1"># primary_container = {"Image": container, "ModelDataUrl": model_data}</span>

<span class="c1"># create_model_response = client.create_model(</span>
<span class="c1">#     ModelName=model_name, ExecutionRoleArn=role, PrimaryContainer=primary_container</span>
<span class="c1"># )</span>

<span class="c1"># print(create_model_response["ModelArn"])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Create-endpoint-configuration">Create endpoint configuration<a class="anchor-link" href="#Create-endpoint-configuration">¶</a></h3><p>SageMaker supports configuring REST endpoints in hosting with multiple models, e.g. for A/B testing purposes. In order to support this, customers create an endpoint configuration, that describes the distribution of traffic across the models, whether split, shadowed, or sampled in some way. In addition, the endpoint configuration describes the instance type required for model deployment.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># from time import gmtime, strftime</span>

<span class="c1"># endpoint_config_name = f"jumpstart-example-xgboostconfig-{strftime('%Y-%m-%d-%H-%M-%S', gmtime())}"</span>

<span class="c1"># print(endpoint_config_name)</span>
<span class="c1"># create_endpoint_config_response = client.create_endpoint_config(</span>
<span class="c1">#     EndpointConfigName=endpoint_config_name,</span>
<span class="c1">#     ProductionVariants=[</span>
<span class="c1">#         {</span>
<span class="c1">#             "InstanceType": "ml.m5.xlarge",</span>
<span class="c1">#             "InitialVariantWeight": 1,</span>
<span class="c1">#             "InitialInstanceCount": 1,</span>
<span class="c1">#             "ModelName": model_name,</span>
<span class="c1">#             "VariantName": "AllTraffic",</span>
<span class="c1">#         }</span>
<span class="c1">#     ],</span>
<span class="c1"># )</span>

<span class="c1"># print(f"Endpoint Config Arn: {create_endpoint_config_response['EndpointConfigArn']}")</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Create-endpoint">Create endpoint<a class="anchor-link" href="#Create-endpoint">¶</a></h3><p>Lastly, the customer creates the endpoint that serves up the model, through specifying the name and configuration defined above. The end result is an endpoint that can be validated and incorporated into production applications. This takes 9-11 minutes to complete.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%time</span>
<span class="c1"># import time</span>

<span class="c1"># endpoint_name = f"jumpstart-example-xgboost-regression-{strftime('%Y-%m-%d-%H-%M-%S', gmtime())}"</span>
<span class="c1"># print(endpoint_name)</span>
<span class="c1"># create_endpoint_response = client.create_endpoint(</span>
<span class="c1">#     EndpointName=endpoint_name, EndpointConfigName=endpoint_config_name</span>
<span class="c1"># )</span>
<span class="c1"># print(create_endpoint_response["EndpointArn"])</span>

<span class="c1"># resp = client.describe_endpoint(EndpointName=endpoint_name)</span>
<span class="c1"># status = resp["EndpointStatus"]</span>
<span class="c1"># while status == "Creating":</span>
<span class="c1">#     print(f"Status: {status}")</span>
<span class="c1">#     time.sleep(60)</span>
<span class="c1">#     resp = client.describe_endpoint(EndpointName=endpoint_name)</span>
<span class="c1">#     status = resp["EndpointStatus"]</span>

<span class="c1"># print(f"Arn: {resp['EndpointArn']}")</span>
<span class="c1"># print(f"Status: {status}")</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Validate-the-model-for-use">Validate the model for use<a class="anchor-link" href="#Validate-the-model-for-use">¶</a></h2><p>Finally, the customer can now validate the model for use. They can obtain the endpoint from the client library using the result from previous operations, and generate classifications from the trained model using that endpoint.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># runtime_client = boto3.client("runtime.sagemaker", region_name=region)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Download test data</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># FILE_TEST = "abalone.test"</span>
<span class="c1"># s3 = boto3.client("s3")</span>
<span class="c1"># s3.download_file(data_bucket, f"{data_prefix}/test/{FILE_TEST}", FILE_TEST)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Start with a single prediction.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># !head -1 abalone.test &gt; abalone.single.test</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%time</span>
<span class="c1"># import json</span>
<span class="c1"># from itertools import islice</span>
<span class="c1"># import math</span>
<span class="c1"># import struct</span>

<span class="c1"># file_name = "abalone.single.test"  # customize to your test file</span>
<span class="c1"># with open(file_name, "r") as f:</span>
<span class="c1">#     payload = f.read().strip()</span>
<span class="c1"># response = runtime_client.invoke_endpoint(</span>
<span class="c1">#     EndpointName=endpoint_name, ContentType="text/x-libsvm", Body=payload</span>
<span class="c1"># )</span>
<span class="c1"># result = response["Body"].read()</span>
<span class="c1"># result = result.decode("utf-8")</span>
<span class="c1"># result = result.split(",")</span>
<span class="c1"># result = [math.ceil(float(i)) for i in result]</span>
<span class="c1"># label = payload.strip(" ").split()[0]</span>
<span class="c1"># print(f"Label: {label}\nPrediction: {result[0]}")</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>OK, a single prediction works. Let's do a whole batch to see how good is the predictions accuracy.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># import sys</span>
<span class="c1"># import math</span>


<span class="c1"># def do_predict(data, endpoint_name, content_type):</span>
<span class="c1">#     payload = "\n".join(data)</span>
<span class="c1">#     response = runtime_client.invoke_endpoint(</span>
<span class="c1">#         EndpointName=endpoint_name, ContentType=content_type, Body=payload</span>
<span class="c1">#     )</span>
<span class="c1">#     result = response["Body"].read()</span>
<span class="c1">#     result = result.decode("utf-8")</span>
<span class="c1">#     result = result.split(",")</span>
<span class="c1">#     preds = [float((num)) for num in result]</span>
<span class="c1">#     preds = [math.ceil(num) for num in preds]</span>
<span class="c1">#     return preds</span>


<span class="c1"># def batch_predict(data, batch_size, endpoint_name, content_type):</span>
<span class="c1">#     items = len(data)</span>
<span class="c1">#     arrs = []</span>

<span class="c1">#     for offset in range(0, items, batch_size):</span>
<span class="c1">#         if offset + batch_size &lt; items:</span>
<span class="c1">#             results = do_predict(data[offset : (offset + batch_size)], endpoint_name, content_type)</span>
<span class="c1">#             arrs.extend(results)</span>
<span class="c1">#         else:</span>
<span class="c1">#             arrs.extend(do_predict(data[offset:items], endpoint_name, content_type))</span>
<span class="c1">#         sys.stdout.write(".")</span>
<span class="c1">#     return arrs</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The following helps us calculate the Median Absolute Percent Error (MdAPE) on the batch dataset.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%time</span>
<span class="c1"># import json</span>
<span class="c1"># import numpy as np</span>

<span class="c1"># with open(FILE_TEST, "r") as f:</span>
<span class="c1">#     payload = f.read().strip()</span>

<span class="c1"># labels = [int(line.split(" ")[0]) for line in payload.split("\n")]</span>
<span class="c1"># test_data = [line for line in payload.split("\n")]</span>
<span class="c1"># preds = batch_predict(test_data, 100, endpoint_name, "text/x-libsvm")</span>

<span class="c1"># print(</span>
<span class="c1">#     "\n Median Absolute Percent Error (MdAPE) = ",</span>
<span class="c1">#     np.median(np.abs(np.array(labels) - np.array(preds)) / np.array(labels)),</span>
<span class="c1"># )</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Delete-Endpoint">Delete Endpoint<a class="anchor-link" href="#Delete-Endpoint">¶</a></h3><p>Once you are done using the endpoint, you can use the following to delete it.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># client.delete_endpoint(EndpointName=endpoint_name)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Appendix">Appendix<a class="anchor-link" href="#Appendix">¶</a></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Data-split-and-upload">Data split and upload<a class="anchor-link" href="#Data-split-and-upload">¶</a></h3><p>Following methods split the data into train/test/validation datasets and upload files to S3.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># import io</span>
<span class="c1"># import boto3</span>
<span class="c1"># import random</span>


<span class="c1"># def data_split(</span>
<span class="c1">#     FILE_DATA, FILE_TRAIN, FILE_VALIDATION, FILE_TEST, PERCENT_TRAIN, PERCENT_VALIDATION, PERCENT_TEST</span>
<span class="c1"># ):</span>
<span class="c1">#     data = [l for l in open(FILE_DATA, "r")]</span>
<span class="c1">#     train_file = open(FILE_TRAIN, "w")</span>
<span class="c1">#     valid_file = open(FILE_VALIDATION, "w")</span>
<span class="c1">#     tests_file = open(FILE_TEST, "w")</span>

<span class="c1">#     num_of_data = len(data)</span>
<span class="c1">#     num_train = int((PERCENT_TRAIN / 100.0) * num_of_data)</span>
<span class="c1">#     num_valid = int((PERCENT_VALIDATION / 100.0) * num_of_data)</span>
<span class="c1">#     num_tests = int((PERCENT_TEST / 100.0) * num_of_data)</span>

<span class="c1">#     data_fractions = [num_train, num_valid, num_tests]</span>
<span class="c1">#     split_data = [[], [], []]</span>

<span class="c1">#     rand_data_ind = 0</span>

<span class="c1">#     for split_ind, fraction in enumerate(data_fractions):</span>
<span class="c1">#         for i in range(fraction):</span>
<span class="c1">#             rand_data_ind = random.randint(0, len(data) - 1)</span>
<span class="c1">#             split_data[split_ind].append(data[rand_data_ind])</span>
<span class="c1">#             data.pop(rand_data_ind)</span>

<span class="c1">#     for l in split_data[0]:</span>
<span class="c1">#         train_file.write(l)</span>

<span class="c1">#     for l in split_data[1]:</span>
<span class="c1">#         valid_file.write(l)</span>

<span class="c1">#     for l in split_data[2]:</span>
<span class="c1">#         tests_file.write(l)</span>

<span class="c1">#     train_file.close()</span>
<span class="c1">#     valid_file.close()</span>
<span class="c1">#     tests_file.close()</span>


<span class="c1"># def write_to_s3(fobj, bucket, key):</span>
<span class="c1">#     return (</span>
<span class="c1">#         boto3.Session(region_name=region).resource("s3").Bucket(bucket).Object(key).upload_fileobj(fobj)</span>
<span class="c1">#     )</span>


<span class="c1"># def upload_to_s3(bucket, channel, filename):</span>
<span class="c1">#     fobj = open(filename, "rb")</span>
<span class="c1">#     key = f"{prefix}/{channel}"</span>
<span class="c1">#     url = f"s3://{bucket}/{key}/{filename}"</span>
<span class="c1">#     print(f"Writing to {url}")</span>
<span class="c1">#     write_to_s3(fobj, bucket, key)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Data-ingestion">Data ingestion<a class="anchor-link" href="#Data-ingestion">¶</a></h3><p>Next, we read the dataset from the existing repository into memory, for preprocessing prior to training. This processing could be done <em>in situ</em> by Amazon Athena, Apache Spark in Amazon EMR, Amazon Redshift, etc., assuming the dataset is present in the appropriate location. Then, the next step would be to transfer the data to S3 for use in training. For small datasets, such as this one, reading into memory isn't onerous, though it would be for larger datasets.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%time</span>
<span class="c1"># import urllib.request</span>

<span class="c1"># bucket = sagemaker.Session().default_bucket()</span>
<span class="c1"># prefix = "sagemaker/DEMO-xgboost-abalone-default"</span>
<span class="c1"># # Load the dataset</span>
<span class="c1"># FILE_DATA = "abalone"</span>
<span class="c1"># urllib.request.urlretrieve(</span>
<span class="c1">#     "https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/regression/abalone", FILE_DATA</span>
<span class="c1"># )</span>

<span class="c1"># # split the downloaded data into train/test/validation files</span>
<span class="c1"># FILE_TRAIN = "abalone.train"</span>
<span class="c1"># FILE_VALIDATION = "abalone.validation"</span>
<span class="c1"># FILE_TEST = "abalone.test"</span>
<span class="c1"># PERCENT_TRAIN = 70</span>
<span class="c1"># PERCENT_VALIDATION = 15</span>
<span class="c1"># PERCENT_TEST = 15</span>
<span class="c1"># data_split(</span>
<span class="c1">#     FILE_DATA, FILE_TRAIN, FILE_VALIDATION, FILE_TEST, PERCENT_TRAIN, PERCENT_VALIDATION, PERCENT_TEST</span>
<span class="c1"># )</span>

<span class="c1"># # upload the files to the S3 bucket</span>
<span class="c1"># upload_to_s3(bucket, "train", FILE_TRAIN)</span>
<span class="c1"># upload_to_s3(bucket, "validation", FILE_VALIDATION)</span>
<span class="c1"># upload_to_s3(bucket, "test", FILE_TEST)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>